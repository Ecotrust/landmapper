{% extends 'visualize/planner.html' %}
{% load static %}

{% block title %}Land Mapper{% endblock %}

{% block extra_css %}
  {% include 'landmapper/blocks/extra_css.html' %}
{% endblock extra_css %}

{% block extra_head %}
  {% include 'landmapper/blocks/extra_head.html' %}
{% endblock extra_head %}

{% block header %}
  {% include 'landmapper/blocks/navbar.html' %}
{% endblock header %}

{% block outer_content %}

    {% include "visualize/modals.html" %}

    <div class="container-fluid" id="primary-content">
        <div id="fullscreen">
          <nav>
            <div class="col-md-4 col-md-offset-1">
              <form class="form-search hide-collapsed" data-bind="submit: layerSearch">
                  <div class="input-group inner-addon">
                      <!-- data-provide="typeahead"  -->
                      <input type="text" class="search-box main-search form-control"
                             data-bind="value: searchTerm, event: { keyup: keySearch }"
                             style="text-overflow: ellipsis;"
                             placeholder="Search data" id="data-search-input">

                      <i class="fa fa-search right search-icon" data-bind="visible: !searchTermInput()"></i>
                      <i class="btn fa fa-close right"style="display:none" data-bind="visible: searchTermInput(), click: clearSearch"></i>
                  </div>
              </form>
            </div>
            <div class="col-md-2">
              <button class="btn btn-default" id="select-taxlot">Select Tax Lot</button>
            </div>
            <div class="col-md-2">
              <div data-bind="with: app.viewModel.scenarios">
                {% if user.is_authenticated %}
                  <button class="btn btn-default" id="draw-parcel" data-bind="click: function () { openDrawingAuth() }, clickBubble: false">Draw New Boundary</button>
                {% else %}
                  <button class="btn btn-default" id="draw-parcel" data-bind="click: function () { openDrawingAnonomous(); }, clickBubble: false">Draw Boundary</button>
                {% endif %}
              </div>
            </div>
          </nav>
            <div id="map-wrapper">
                <div id="map" click="click: outsideSubLayer"></div>
                <div id="map-controls" class="hidden"> <!-- Basemaps, Legends, Layers, Bookmarks, and FullScreen buttons -->
                  <div class="btn-group btn-group-vertical">
                    <!-- Print Button -->
                    <a class="btn" id="btn-print" onclick="window.print();" data-toggle="tooltip" data-placement="left" title="Print/Export">
                      <i class="fa fa-print" id="print-icon"> </i>
                    </a>
                    <!--Map Links Button-->
                    <a id="basemap-button" class="btn" data-toggle="tooltip" data-placement="left" title="Share this Map" data-bind="click: showMapLinks">
                        <i class="fa fa-link"></i>
                    </a>
                    {% if user.is_authenticated %}
                    <!-- Session Layer Button-->
                    <a id="wms-button" class="btn" data-toggle="tooltip" data-placement="left" title="Add a ArcRest Layer ">
                        <i class="fa fa-location-arrow"></i>
                    </a>
                    {% endif %}
                  </div>
                </div>
                <div id="baselayers">
                      <div id="toggleBaselayer" data-bind="click: showBasemaps">
                            <!--Baselayers Button-->
                                Basemaps
                          </div>
                  </div>
                <!-- the following container is used to estimate width for the actual Aggregated Attribution Overlay -->
                <div id="aggregated-attribute-overlay-test" style="position: absolute; visibility: hidden; height: auto; width: auto; top:0px">
                      <div data-bind="foreach: attributeLayers()" style="overflow: hidden; max-height: 10px;">
                          <div data-bind="css: {display: $root.aggregatedAttributes()[featureAttributionName] ? 'block' : 'none'}">
                              <h4 data-bind="text: featureAttributionName"></h4>
                              <dl data-bind="foreach: { data: $root.aggregatedAttributes()[featureAttributionName], afterAdd:$root.updateMarker }">
                                  <dt>
                                      <span data-bind="text: display"></span><span data-bind="visible: display && data ? true : data===0">:</span>
                                      <span style="font-weight: normal" data-bind="text: data"></span>
                                  </dt>
                              </dl>
                          </div>
                      </div>
                  </div>
                <!-- Aggregated Attribution Overlay -->
                <div id="aggregated-attribute-overlay" data-bind="visible: aggregatedAttributes && showFeatureAttribution, style: {width: aggregatedAttributesWidth}" style="display: none">
                      <div id="aggregated-attribute-heading">
                          <h4>Available Information</h4>
                      </div>
                      <div id="aggregated-attribute-content" class="accordion">
                          <div data-bind="foreach: attributeLayers()">
                              <div class="accordion-group">
                                  <div data-bind="visible: $root.aggregatedAttributes()[featureAttributionName]">
                                      <div class="accordion-heading" data-bind="click: toggleLayerAttribution, css: { 'active': showingLayerAttribution }">
                                          <a class="accordion-toggle">
                                              <span data-bind="text: featureAttributionName"></span>
                                          </a>
                                      </div>
                                      <div class="accordion-body collapse in" data-bind="attr: { id: $root.convertToSlug(featureAttributionName) }" >
                                          <div class="accordion-inner">
                                              <dl data-bind="foreach: { data: $root.aggregatedAttributes()[featureAttributionName], afterAdd:$root.updateMarker }">
                                                  <dt>
                                                      <!-- ko if: $data.hasOwnProperty("tab") -->
                                                      <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                      <!-- /ko -->
                                                      <span data-bind="text: display"></span><span data-bind="visible: display && data ? true : data===0">:</span>
                                                      <span style="font-weight: normal" data-bind="text: data"></span>
                                                  </dt>
                                              </dl>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <span id="close-attribute-overlay" class="pull-right"><a href="#" style="position: absolute; top: 0px; right: 0px; opacity: .6;" class="btn btn-mini close" data-bind="click: closeAttribution"> x </a> </span>
                  </div>

                  <!-- Bookmark Message -->
                  <div id="error-overlay" data-bind="visible: error() === 'restoreState'" style="display:none">
                      <div>
                          <span class="pull-right">
                              <a href="#" style="margin-left: 10px; opacity: .6;" class="close btn btn-mini" data-bind="click: closeAlert"> x </a>
                              <a class="btn btn-mini" data-bind="click: bookmarks.restoreState">
                                  Return to Previous View
                              </a>
                          </span>
                          <span data-bind="text: bookmarks.activeBookmark"></span>
                          <div class="clearfix"></div>
                      </div>
                  </div>

                <div id="left-panel" class="panel panel-default collapsible collapsed hidden" data-bind="css: { collapsed: !showLayers() }">
                    <div class="panel-heading">
                        <div class="panel-title">
                            <div class="show-collapsed" style="display:none">
                                <div data-bind="visible: activeLayers().length > 0">
                                    <span data-bind="text: activeLayers().length">0</span> Active
                                </div>
                            </div>
                            <a data-bind="click: toggleLayers" class="collapse-button">
                                <i class="fa fa-angle-double-left"></i>
                            </a>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="frame tabs" id="data-panel" data-bind="visible: showLayers()">

                            <div class="sidebar-nav">
                                <ul id="myTab" class="nav nav-tabs">
                                    <li data-tab="active">
                                        <h4>
                                            <a href="#active" data-toggle="tab" id="activeTab">Active
                                                <span data-bind="visible: activeLayers().length > 0">
                                                    &#8226;&nbsp;<span class="count" data-bind="text: activeLayers().length">0</span>
                                                </span>
                                            </a>
                                        </h4>
                                    </li>
                                    <li class="active" data-tab="designs">
                                        <h4>
                                            <a href="#designs" data-toggle="tab" id="designsTab">MyPlanner</a>
                                        </h4>
                                    </li>
                                    <li data-tab="data" >
                                        <h4>
                                            <a href="#data" data-toggle="tab" id="dataTab">Data</a>
                                        </h4>
                                    </li>
                                    <li data-tab="legend" >
                                        <h4>
                                            <a href="#legend" data-toggle="tab" id="dataTab">Legend</a>
                                        </h4>
                                    </li>
                                </ul>
                                <div id="myTabContent" class="tab-content">
                                    <!-- ACTIVE TAB -->
                                    <div class="tab-pane " id="active">
                                        <div data-bind="visible: activeLayers().length === 0">
                                            <div style="padding: 10px;">
                                                <p>
                                                    You currently have no activated data layers.
                                                </p>
                                                <p>
                                                    Data layers that are activated in the Data panel will appear in this Active panel.
                                                </p>
                                                <p>
                                                    Data layers in the Active panel can be adjusted in terms of their transparency and their ordering on the map.
                                                </p>
                                            </div>
                                        </div>
                                        <ul class="unstyled list" data-bind="sortable: { data: activeLayers, options: {  } }">
                                            <li>
                                                <div class="active-wrapper">
                                                    {% include "visualize/includes/active-layer-row.html" %}
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <!-- END ACTIVE TAB -->
                                    <!-- DATA TAB -->
                                    <div class="tab-pane" id="data">
                                        <div class="accordion-wrapper">
                                            <!-- data accordion -->
                                            <div id="data-accordion">
                                                <div class="accordion" data-bind="foreach: themes">
                                                    <!-- ko ifnot: isCompanionTheme() -->
                                                    <div class="accordion-group">
                                                        <div class="accordion-heading" data-bind="click: setOpenTheme, css: { 'active': isOpenTheme() }">
                                                            <div>
                                                                <a class="accordion-toggle">
                                                                    <span data-bind="text: name">Themes</span></a>
                                                            </div>
                                                        </div>
                                                        <div class="accordion-body collapse" data-bind="css: { 'in': isOpenTheme() }">
                                                            <div class="accordion-inner">
                                                                <!-- ko if: isMarineLife() -->
                                                                <img src="/static/visualize/img/mdat-ajax.gif"
                                                                     id="mdat-load">
                                                                <ul  class="unstyled" data-bind="foreach: layers ">
                                                                    <li class="layer dropdown" data-bind="css: {'open': showSublayers() }, attr: {name: name}">
                                                                        {% include "visualize/includes/mdat-sublayer-search.html" %}
                                                                    </li>
                                                                </ul>
                                                                <!-- /ko -->
                                                                <!-- ko if: isVTR() -->
                                                                <img src="/static/visualize/img/mdat-ajax.gif"
                                                                     id="vtr-load">
                                                                <ul  class="unstyled" data-bind="foreach: layers ">
                                                                    <li class="layer dropdown" data-bind="css: {'open': showSublayers() }, attr: {name: name}">
                                                                        {% include "visualize/includes/vtr-cas.html" %}
                                                                    </li>
                                                                </ul>
                                                                <!-- /ko -->
                                                                <!-- ko ifnot: isMarineLife() -->
                                                                <!-- ko ifnot: isVTR() -->
                                                                <ul  class="unstyled" data-bind="foreach: layers ">
                                                                    <li class="layer dropdown" data-bind="css: {'open': showSublayers() }, attr: {name: name}">
                                                                        {% include "visualize/includes/catalog-layer-row.html" %}
                                                                    </li>
                                                                </ul>
                                                                <!-- /ko -->
                                                                <!-- /ko -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- /ko -->
                                                </div>
                                            </div>
                                            <!-- /data-accordion -->
                                        </div>
                                    </div>
                                    <!-- END DATA TAB -->

                                    <!-- DESIGNS TAB -->
                                    {% if anonymousDraw and not user.is_authenticated %}
                                      <div data-bind="with: app.viewModel.scenarios">
                                        <div class="accordion-group">
                                          <div class="collections-header">
                                            <div id="drawings-header"
                                                 class="accordion-heading"
                                                 data-bind="click: toggleDrawingsOpen, css: { 'active': isDrawingsOpen() }">
                                              <div>
                                                <a class="accordion-toggle">
                                                  <span>Drawings</span>
                                                </a>
                                                <a class="create-new-button" data-bind="click: createAnonomousPolygonDesign, clickBubble: false"><i class="fa fa-plus"></i>NEW</a>
                                              </div>
                                            </div>
                                          </div>
                                          <ul class="unstyled list"
                                              data-bind="foreach: drawingList ">
                                              <li class="layer">
                                                  <table class="layer-row">
                                                      <tr>
                                                          <td>
                                                              <a class="btn btn-info-sign"
                                                                 data-bind="click: toggleDescription, css: { 'active': infoActive()}"
                                                                 data-toggle="tooltip"
                                                                 data-placement="right"
                                                                 data-title="More Info">
                                                                  <i class="fa fa-info-circle"></i>
                                                              </a>
                                                          </td>
                                                          <td class="layer-name">
                                                              <a class="btn btn-layer"
                                                                 data-bind='click: toggleActive'>
                                                                  <table>
                                                                      <tr>
                                                                          <td class="text">
                                                                          <span rel="tooltip"
                                                                                data-bind="visible: shared, attr: {title: sharedBy}">
                                                                              <i class="fa fa-user"></i>
                                                                          </span>
                                                                          <span rel="tooltip"
                                                                                data-bind="visible: selectedGroups().length, attr: {title: sharedWith}">
                                                                              <i class="fa fa-group"></i>
                                                                          </span>
                                                                              <span data-bind='text: name'></span>
                                                                          </td>
                                                                          <td class="add-on">
                                                                              <i class="fa fa-check-circle"
                                                                                 data-bind="css: { 'fa-check-circle': active() && visible(), 'fa-circle-o': !(active() && visible()) }"></i>
                                                                          </td>
                                                                      </tr>
                                                                  </table>
                                                              </a>
                                                          </td>
                                                          <td>
                                                              <a class="btn"
                                                                 data-bind="visible: shared(), click: app.menuModel.menu('sharedDrawing')"><i
                                                                      class="fa fa-cog"></i></a>
                                                              <a class="btn"
                                                                 data-bind="visible: !shared(), click: app.menuModel.menu('drawing')"><i
                                                                      class="fa fa-cog"></i></a>
                                                          </td>
                                                      </tr>
                                                  </table>
                                                  <div class="layer-info"
                                                       data-bind="visible: infoActive()">
                                                      <div class="link-bar"
                                                           data-bind="if: $data.hasOwnProperty('kml') || $data.hasOwnProperty('data_download') || $data.hasOwnProperty('metadata') || $data.hasOwnProperty('source') || $data.hasOwnProperty('tiles')">
                                                          <span data-toggle="tooltip"
                                                                data-placement="bottom"
                                                                data-container="body"
                                                                title="Download for Google Maps">
                                                              <!-- ko if: $data.hasOwnProperty("kml") -->
                                                              <a class="btn btn-mini"
                                                                 data-bind="css: { disabled: ! kml }, attr: { href: kml }"
                                                                 target="_blank">
                                                                  kml <i
                                                                      class="fa fa-arrow-down"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                              <!-- ko ifnot: $data.hasOwnProperty("kml") -->
                                                              <a class="btn btn-mini disabled">
                                                                  kml <i
                                                                      class="fa fa-arrow-down"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                          </span>
                                                          <span data-toggle="tooltip"
                                                                data-placement="bottom"
                                                                data-container="body"
                                                                data-title="Download ESRI Formatted Dataset">
                                                              <!-- ko if: $data.hasOwnProperty("data_download") -->
                                                              <a class="btn btn-mini"
                                                                 data-bind="css: { disabled: ! data_download }, attr: { href: data_download }"
                                                                 target="_blank">
                                                                  data <i
                                                                      class="fa fa-arrow-down"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                              <!-- ko ifnot: $data.hasOwnProperty("data_download") -->
                                                              <a class="btn btn-mini disabled">
                                                                  data <i
                                                                      class="fa fa-arrow-down"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                          </span>
                                                          <span data-toggle="tooltip"
                                                                data-placement="bottom"
                                                                data-container="body"
                                                                data-title="View Metadata">
                                                              <!-- ko if: $data.hasOwnProperty("metadata") -->
                                                              <a class="btn btn-mini"
                                                                 data-bind="css: { disabled: ! metadata }, attr: { href: metadata }"
                                                                 target="_blank">
                                                                  metadata <i
                                                                      class="fa fa-external-link-square"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                              <!-- ko ifnot: $data.hasOwnProperty("metadata") -->
                                                              <a class="btn btn-mini disabled">
                                                                  metadata <i
                                                                      class="fa fa-external-link-square"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                          </span>
                                                          <span data-toggle="tooltip"
                                                                data-placement="bottom"
                                                                data-container="body"
                                                                data-title="Link to Dataset Source Provider">
                                                              <!-- ko if: $data.hasOwnProperty("source") -->
                                                              <a class="btn btn-mini"
                                                                 data-bind="css: { disabled: ! source }, attr: { href: source }"
                                                                 target="_blank">
                                                                  source <i
                                                                      class="fa fa-external-link-square"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                              <!-- ko ifnot: $data.hasOwnProperty("source") -->
                                                              <a class="btn btn-mini disabled">
                                                                  source <i
                                                                      class="fa fa-external-link-square"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                          </span>
                                                          <span data-toggle="tooltip"
                                                                data-placement="bottom"
                                                                data-container="body"
                                                                data-title="Link to Tiles Page">
                                                              <!-- ko if: $data.hasOwnProperty("tiles") -->
                                                              <a class="btn btn-mini"
                                                                 data-bind="css: { disabled: ! tiles }, attr: { href: tiles }"
                                                                 target="_blank">
                                                                  tiles <i
                                                                      class="fa fa-external-link-square"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                              <!-- ko ifnot: $data.hasOwnProperty("tiles") -->
                                                              <a class="btn btn-mini disabled">
                                                                  tiles <i
                                                                      class="fa fa-external-link-square"></i>
                                                              </a>
                                                              <!-- /ko -->
                                                          </span>
                                                      </div>
                                                      <div class="layer-text">
                                                          <span data-bind="truncatedText: description, maxTextLength: 200"></span>
                                                          <!-- ko if: $data.data_url -->
                                                          <a data-bind="attr: {href: $data.data_url}">read
                                                              more</a>.
                                                          <!-- /ko -->
                                                      </div>
                                                  </div>
                                              </li>
                                          </ul>
                                        </div>
                                      </div>
                                      <div class="tab-pane active" id="designs" data-tab="designs" data-bind="">
                                        <div class="featurepanel">
                                          <div id="drawing-form" class="design">
                                            <h4>Drawing</h4>
                                            <form id="polygon-design-form" action="features/aoi/form/" method="post">
                                                <input type="hidden" name="user" id="id_user" />
                                                <input type="hidden" name="manipulators" id="id_manipulators" />
                                                <script class="point" id="geometry_orig_kml" type="application/vnd.google-earth.kml+xml"></script>
                                                <input type="hidden" name="geometry_orig" id="id_geometry_orig" />
                                                <script class="point" id="geometry_final_kml" type="application/vnd.google-earth.kml+xml"></script>
                                                <input type="hidden" name="geometry_final" id="id_geometry_final" />

                                                <div id="error_bar"></div>
                                                <div id="step1" class="step">
                                                    <p class="step-text"><i>Step 1 of 2 </i>
                                                    <div data-bind="visible: ! showEdit()">
                                                        <p id="click-to-begin-drawing" class="instructions">Click the button below to begin drawing your polygon.</p>
                                                        <a class="btn btn-warning" style="margin-top: 10px" data-bind="click: startSketch, css: { disabled: isDrawing() }">
                                                            <span>Draw Shape</span>
                                                        </a>
                                                    </div>
                                                    <div data-bind="visible: showEdit()">
                                                        <p class="instructions">Click <b>Next</b> if you are satisfied with your shape.</p>
                                                        <p class="instructions">Click <b>Edit Shape</b> if you would like to make changes to your shape.</p>
                                                        <p class="instructions">Click <b>Add Shape</b> if you would like to add more shapes to your drawing (multipolygon).</p>
                                                        <a class="btn btn-default" style="margin-top: 10px" data-bind="click: startEdit, css: { disabled: (isEditing() || isDrawing()) }">
                                                            <span>Edit Shape</span>
                                                        </a>
                                                        <a class="btn btn-default" style="margin-top: 10px" data-bind="click: startSketch, css: { disabled: (isEditing() || isDrawing()) }">
                                                            <span>Add Shape</span>
                                                        </a>
                                                        <div data-bind="visible: isEditing()">
                                                            <p class="instructions">
                                                                Click and drag the handles or vertices of the shape.
                                                            </p>
                                                            <p class="instructions">
                                                                When you are done, click <b>Done Editing</b> below.
                                                            </p>
                                                            <a class="btn btn-warning" style="margin-top: 10px" data-bind="click: completeEdit">
                                                                <span>Done Editing</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    <div data-bind="visible: isDrawing()" style="padding-top: 20px" >
                                                        <div class="well">
                                                            <div>
                                                                Click on the map to add the points that make up your polygon.
                                                            </div>
                                                            <div id="double-click-instructions" style="padding-top: 10px">
                                                                Double-click to finish drawing.
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="PanelGeometry"></div>
                                                </div>
                                                <div class="step" id="step2">
                                                    <p class="step-text"><i>Step 2 of 2 </i></p>
                                                    <p class="instructions">Provide a <b>Name</b> to identify your Drawing </p>
                                                    <div class="step3-inputs">
                                                        <div class="step3-param">
                                                            <input type="text" name="name" required maxlength="255" id="id_name" />
                                                            <div id="invalid-name-message" class="control-group error" style="display: none;">
                                                                <span class="help-inline">The <b>Name</b> field is required.</span>
                                                            </div>
                                                        </div>
                                                        <p class="instructions">Optionally, you may add a <b>Description</b> <!--and/or attach a file--> </p>
                                                        <div class="step3-param">
                                                            <textarea name="description" cols="30" id="id_description" rows="3"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="wizard_nav">
                                                    <div class="btn-group pull-right">
                                                        <a href="#" class="btn btn-default" onclick="this.blur(); return false;" id="button_prev"><span>&lt; Previous</span></a>
                                                        <a href="#" class="btn btn-primary"  onclick="this.blur(); return false;" id="button_next"><span>Next &gt;</span></a>
                                                        <a href="#" class="submit_button btn btn-primary" onclick="this.blur(); return false;"><span>Save</span></a>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="btn-group pull-left">
                                                        <a href="#" class="cancel_button btn btn-default"><span>Cancel</span></a>
                                                    </div>
                                                </div>
                                            </form>
                                          </div>
                                        </div>
                                      </div>
                                    {% else %}
                                      {% include "landmapper/scenarios.html" %}
                                    {% endif %}
                                    <!-- END DESIGNS TAB -->
                                    <!-- LEGEND TAB -->
                                    <div class="tab-pane" id="legend">
                                        <div id="embedded-legend-wrapper">
                                            <div id="embedded-legend-content">
                                                <div style="padding: 10px">
                                                    <div data-bind="visible: activeLegendLayers().length == 0">
                                                        No data layers containing legends are activated.
                                                    </div>

                                                    <div data-bind="foreach: activeLegendLayers">
                                                    <!--<div data-bind="foreach: { data: activeLegendLayers, afterRender: updateScrollBars }">-->
                                                        <div style="padding-bottom: 18px;">
                                                            <span class="pagination-centered legend-title" data-bind="html: legendTitle ? legendTitle : name"></span>
                                                            <p class="legend-subtitle" data-bind="visible: legendSubTitle, html: legendSubTitle"></p>
                                                            <span data-bind="if: legend">
                                                                <div data-bind="if: legend['elements']">
                                                                    <div data-bind="foreach: legend['elements']">
                                                                        <div>
                                                                            <img data-bind="attr: {src: swatch}" />
                                                                            <span data-bind="text: label" style="font-size: 11px; font-weight: bold;"></span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div data-bind="if: !legend['elements']">
                                                                    <div data-bind="css: { 'in': legendVisibility }" style="padding: 5px 0 0 10px;">
                                                                        <img data-bind="attr: { src: legend }" />
                                                                    </div>
                                                                </div>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- END LEGEND TAB -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <span class="timestamp" data-bind="visible: mapTitle"><span data-bind="text: new Date().toString('M/d/yyyy HH:mm')"></span></span>
        </div>

        <!-- transparency tool -->
        <div style="display:none" id="opacity-popover" class="popover fade bottom in">
            <div class="arrow">
            </div>
            <div class="popover-inner">
                <div class="popover-content" data-bind="if: selectedLayer">
                    <div class="slider" data-bind="jqSlider: selectedLayer().opacity, jqOptions: { min: 0, max: 1, step: .01, range: 'min' }"></div>
                </div>
            </div>
        </div>

        {% include "visualize/bookmarks.html" %}
    </div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'bower_components/amplify/lib/amplify.min.js' %}"></script>
  <script src="{% static 'bower_components/jquery-migrate/jquery-migrate.min.js' %}"></script>
  <script src="{% static 'bower_components/jquery.bbq/jquery.ba-bbq.js' %}"></script>
  <script src="{% static 'bower_components/bootstrap3-typeahead/bootstrap3-typeahead.js' %}"></script>
  <script src="{% static 'bower_components/jquery-ui/jquery-ui.min.js' %}"></script>
  <script charset="utf-8">
      $.widget.bridge('uitooltip', $.ui.tooltip);
  </script>
  <script src="{% static 'js/jsonrpc.js' %}"></script>

  <script src="{% static 'js/lib/lodash.min.js' %}"></script>
  <script src="{% static 'js/lib/knockout-3.3.0.js' %}"></script>
  <script src="{% static 'js/lib/knockout.mapping-2.4.1.js' %}"></script>
  <script src="{% static 'js/knockout-bindings.js' %}"></script>
  <script src="{% static 'js/lib/highcharts/highcharts.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/lib/highcharts/highcharts-more.js' %}" type="text/javascript"></script>
  <script src="http://maps.google.com/maps/api/js?key=AIzaSyBQ7ivDG-GxSqWWh0Q9OCVQ-qbhuKrkCg4&amp;v=3.6&amp;sensor=false"></script>
  <script src="{% static 'js/lib/openlayers/OpenLayers-marco-min.js' %}"></script>
  <script src="{% static 'bower_components/bigscreen/bigscreen.js' %}"></script>
  <script src="{% static 'bower_components/jqueryui-touch-punch/jquery.ui.touch-punch.min.js' %}"></script>

  <script src="{% static 'landmapper/js/controls.js' %}"></script>

  <script src="{% static 'js/contextual_menu.js' %}"></script>
  <script src="{% static 'js/fixtures.js' %}"></script>
  <script src="{% static 'landmapper/js/map.js' %}"></script>
  <script src="{% static 'landmapper/js/state.js' %}"></script>
  <script src="{% static 'js/bookmarks.js' %}"></script>
  <script src="{% static 'landmapper/js/scenarios.js' %}"></script>
  <script src="{% static 'js/reports.js' %}"></script>
  <script src="{% static 'js/drawing.js' %}"></script>
  <script src="{% static 'landmapper/js/models.js' %}"></script>
  {% if anonymousDraw and not user.is_authenticated %}
    <script src="{% static 'landmapper/js/anonomous_draw.js' %}"></script>
  {% endif %}
  <script src="{% static 'js/server.js' %}"></script>
  <script src="{% static 'landmapper/js/app.js' %}"></script>

  <!--<script src="{% static 'js/html2canvas.js' %}"></script>-->
  <!--<script src="{% static 'js/html2canvas.svg.js' %}"></script>-->
{% endblock extra_js %}
